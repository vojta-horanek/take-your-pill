\documentclass[../TakeYourPill.tex]{subfiles}
\graphicspath{{\subfix{images/}}}

\begin{document}

Obrazovka \enquote{Nový lék} (\texttt{EditFragment}) má dvě funkce. Slouží jako obrazovka pro přidávání nového léku a zároveň se používá pro úpravu léku. Titulek obrazovky se mění podle použití. Opět je implementována jako fragment. Pro každý lék je možno nastavit název a popis. Tyto dvě hodnoty se zapisují do prvku \texttt{TextInputLayout} z knihovny \textit{material}. Následuje nastavení barvy. Uživatel má na výběr ze sedmi barev: modrá, tmavě modrá, tyrkysová, zelená, žlutá, oranžová a červená. Vybírání barvy je implementováno pomocí prvku \texttt{RecyclerView} s atributem \texttt{orientation} nastaveným na hodnotu \texttt{horizontal}. Jednotlivé barvy jsou definované třídou \texttt{PillColor}. Dále si uživatel nastaví připomínky. Při kliknutí na připomínku nebo na tlačítko \enquote{přidat připomínku} se zobrazí \texttt{ReminderDialog} kde uživatel může upravit/vytvořit připomínku. U připomínky lze nastavit i množství léku, jaké si v daný čas má uživatel vzít. Pro jeden lék nelze nastavit dvě připomínky se stejným časem, každá připomínka musí mít unikátní čas. V neposlední řade lze léku nastavit příjem. Uživatel si může zvolit, zda lék bere neustále, jen určitý počet dní a nebo v cyklu X dní aktivních, Y dní neaktivních. Tento prvek\footnote{prvkem je myšlen prvek uživatelského rozhraní, neboli \texttt{view}} je implementován v \texttt{PillOptionsView}, který dědí z \texttt{LinearLayout} a používá layout \texttt{layout\_pill\_options\_view.xml}. Veškerá logika výběru příjmu je implementována v této třídě. Jediné, o co se \texttt{EditFragment} musí postarat, je získání \texttt{ReminderOptions} (vysvětleno v kapitole \ref{sec:reminder}) z tohoto prvku pomocí metody \texttt{getOptions()}.

K léku lze přidat i fotografii. Prvek na výběr fotografie je implementován v \texttt{ImageChooserView}. Tato třída dědí z \texttt{LinearLayout} a používá layout definovaný v \texttt{layout\_image\_chooser.xml}. Pokud lék již nějakou fotografii obsahuje, prvek zobrazí tlačítko na její odstranění. Při výběru fotografie je použita knihovna \textit{EasyPermissions} \cite{easy-permissions} pro zajištění potřebných oprávnění a upravená verze knihovny \textit{imagepicker} \cite{imagepicker}. Knihovnu jsem upravil tak, aby respektovala vzhled aplikace. Zaprvé již nepoužívá standardní \texttt{AlertDialog}, nýbrž \texttt{BottomSheetDialog} a také vzhled tohoto dialogu byl upraven, aby odpovídal všem ostatním dialogům v aplikaci. Uživatel si může zvolit, zda chce fotografii vybrat z galerie, nebo chce vyfotit fotografii novou. Po vybrání/vyfocení se uživateli ukáže obrazovka, kde může fotografii upravit. Pro úpravu fotografie jsem použil knihovnu \textit{uCrop} \cite{ucrop}, kterou jsem také upravil. Oproti originální verzi se liší v použití prvků na navigaci, ikonách, podporou automatického tmavého vzhledu a sladěním do vzhledu aplikace. Knihovna uživateli umožní fotografii oříznout, otočit a škálovat. Pro plynulejší úpravy jsem zvolil \enquote{native} verzi knihovny, knihovna tak využívá kód napsaný v C++, který je rychlejší a optimalizovaný pro jednotlivé architektury, avšak přidá k velikosti aplikace cca 1.5 MB.

Po nastavení všech hodnot může uživatel lék uložit pomocí \texttt{FAB} tlačítka. Aplikace lék vloží do databáze (pokud již existuje, tak jej aktualizuje) a naplánuje jeho následující připomínku.

\boxik{
\textbf{PillColor} je třída, používaná pro ukládání barvy léku. Obsahuje atributy \texttt{resource} a \texttt{isChecked}. Atribut \texttt{resource} ukládá \texttt{id} barvy uložené v \textit{App resources} \cite{resource}. Atribut \texttt{isChecked} vyjadřuje, zda je barva vybraná. Tento atribut se používá k zobrazování seznamu barev a zjištění, jakou barvu uživatel vybral.
}


\end{document}
